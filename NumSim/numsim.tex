\documentclass[mathserif]{beamer}

\usetheme[secheader]{Madrid}

\usepackage{tikz}
\usepackage{url}

\usepackage{pygments}
\usepackage{graphicx}

\providecommand{\code}[1]{{\texttt{\scriptsize{#1}}}}

\begin{document}

\section{The Problems}

\begin{frame}{The Challenge: A Flexible Interface to a Complex Model}
  \begin{tikzpicture}[scale=0.7]
    \draw [fill=green!40] (0,0) ellipse [x radius=3mm, y radius=1cm];
    \draw [|-|] (-1,1) -- ++(0,-2) node [pos=0.5,fill=white] {$w$};
    \draw [|-|] (-0.3,-1.4) -- ++(0.6,0) node [pos=0.5,below] {$l$};
    \node at (0, 1.4) {Electron Pulse};
    \draw [thick, ->] (0.3,0) -- ++ (1,0) node [above,pos=1] {$\vec{v} = v \hat{z}$};
    \draw 
      (3,2)
      to [out=-75,in=75] ++(0,-4)
      to [out=105,in=255] ++(0,4)
      node [above] {Magnetic Lens}
    ;
    \draw [fill=gray!50] (5,1.5) rectangle ++(1,-3);
    \node at (5.5,-2.2) [align=center] {RF Cavity\\``z lens''};
    \draw 
      (8,2)
      to [out=-75,in=75] ++(0,-4)
      to [out=105,in=255] ++(0,4)
      node [above] {Magnetic Lens}
    ;
  \end{tikzpicture}
  \begin{itemize}
    \item Compute dynamics of electron pulse
    \item Generation and optical elements add terms to DE
  \end{itemize}
\end{frame}

\begin{frame}{The ``State of the Art''}
  Old codes are
  \begin{itemize}
    \item lacking full 6D dynamics
    \item optimized for performance vs usablilty
    \item hard to customize
    \item near impossible to comprehend
  \end{itemize}
  \begin{block}{\url{http://laacg.lanl.gov/laacg/services/download_sf.phtml}}
    \textbf{Getting Started with Poisson Superfish}\\
    \ldots We do not recommend trying to build an input file ``from scratch.'' Instead, find an example file that is similar to the problem you are trying to solve. Make a copy of the file and then make any necessary modifications to the geometry and options.
  \end{block}
\end{frame}

\begin{frame}{Physical Simulations}
  \begin{block}{Differential Equations}
    A set of rules that define how variables change with some parameter
    \begin{equation*}
      x(t_2) = x(t_1) + dt*\frac{dx}{dt}\visible<2->{(x,f(t1,t2))}
    \end{equation*}
  \end{block}
  \begin{block}{Example}
    \begin{equation*}
      \frac{dx}{dt} = -x \quad\implies\quad x(t) = sin(x*t) + C
    \end{equation*}
  \end{block}
\end{frame}

\begin{frame}{Other Attempts}
  \begin{columns}
    \begin{column}{0.49\linewidth}
      Mathematica:\\
      Pros:
      \begin{itemize}
        \item Can solve dynamics
        \item Pretty-printing of math for readability
      \end{itemize}
      Cons:
      \begin{itemize}
        \item Closed-source and expensive!
        \item No OO and no key-value datatypes
        \item Still rather slow $\sim$2mins$/$sim
      \end{itemize}
    \end{column}
    \begin{column}{0.49\linewidth}
      Modelica:\\
      Pros:
      \begin{itemize}
        \item Open-source, but behind close-source variants
        \item Unique OO language for physical simulation
        \item Classes have DEs as properties
      \end{itemize}
      Cons:
      \begin{itemize}
        \item Lacks ``has-a'' relationship
        \item Composing DEs not trivial
        \item User-facing object instantiation not trivial
        \item Some numerical problems (?)
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\section{Perl Solution}

\begin{frame}{\ldots But First, Some Bookkeeping}
  If an object knows where it is, can it remember where it came from?
  \begin{columns}
    \begin{column}{0.49\linewidth}
      \begin{block}{}
        \scriptsize
        \input{code/remember}
      \end{block}
    \end{column}
    \begin{column}{0.49\linewidth}
      \begin{itemize}
        \item works for fixed width solvers
        \item adaptive solvers call functions repeatedly (i.e. \code{PerlGSL::DiffEq})
          \begin{itemize}
            \item future work: attempt to add callbacks after finished step
          \end{itemize}
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\subsection{A Simple OO-DE Example}

\begin{frame}{The Solver: Attributes}
  \begin{block}{}
    \scriptsize
    \input{code/class1}
  \end{block}
\end{frame}

\begin{frame}{The Solver: Methods}
  \begin{block}{}
    \scriptsize
    \input{code/class2}
  \end{block}
\end{frame}

\begin{frame}{Physical Classes}
  \begin{block}{}
    \scriptsize
    \input{code/class3}
  \end{block}
\end{frame}

\begin{frame}{The Script}
  \begin{columns}
    \begin{column}{0.49\linewidth}
      \begin{block}{}
        \scriptsize
        \input{code/example1}
      \end{block}
    \end{column}
    \begin{column}{0.49\linewidth}
      \begin{block}{}
        \scriptsize
        \input{code/example2}
      \end{block}
      \centering
      \includegraphics[width=0.8\linewidth]{example.png}
    \end{column}
  \end{columns}
\end{frame}

\section{Units Handling}

\begin{frame}{Unit Handling (The Implied Covenant)}
  \begin{block}{Mars Surveyor '98 Orbiter (Sorry Larry!)}
    \begin{itemize}
      \item Software used force in Newtons
      \item Users entered force in Foot-Pounds
    \end{itemize}
  \end{block}
  \vfill
  The Covenant:
  \begin{itemize}
    \item Between programmer and user
    \item ``Use the same units!''
    \item Unexpected and possibly undocumented action at a distance
    \item With Perl and Moose we can do better \ldots
  \end{itemize}
\end{frame}

\begin{frame}{\texttt{MooseX::Types::NumUnit}}
  \begin{itemize}
    \item \code{Str} to \code{Num} coercions
    \item convert unit if needed
  \end{itemize}
  \begin{block}{}
    \scriptsize
    \input{code/numunit}
  \end{block}
\end{frame}

\begin{frame}{Example of \texttt{Physics::UEMColumn}}
  Back to the original problem of Electron Column Modeling
  \begin{itemize}
    \item As yet unreleased \code{Physics::UEMColumn}
    \begin{itemize}
      \item \url{https://github.com/jberger/Physics-UEMColumn}
    \end{itemize}
    \item Uses: \code{PerlGSL::DiffEq} on CPAN
    \begin{itemize}
      \item C-level solver of Perl-level DE closures
    \end{itemize}
  \end{itemize}
\end{frame}

\end{document}
